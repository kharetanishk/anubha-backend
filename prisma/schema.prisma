generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ---------- ENUMS ----------
 */
enum Role {
  USER
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum ServiceType {
  NUTRITION
  FITNESS
  DIET_PLAN
}

enum StorageProvider {
  CLOUDINARY
  S3
  LOCAL
}

enum Gender {
  MALE
  FEMALE
}

enum SleepQuality {
  SOUND
  DISTURBED
}

enum FoodPreference {
  VEG
  NON_VEG
  EGG_VEG
}

enum BowelMovement {
  NORMAL
  CONSTIPATION
  DIARRHEA
  IRREGULAR
}

/**
 * ---------- MODELS ----------
 */


model User {
  id           String        @id @default(uuid())
  name         String
  email         String       @unique
  // phone        String        @unique
  role          Role         @default(USER)
  patients      PatientDetials[]
  appointments  Appointment[]
  refreshTokens RefreshToken[] 
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model OTP {
  id        String   @id @default(uuid())
  email     String
  code      String          // hashed OTP
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  userId  String?
  adminId String?

  user  User?  @relation(fields: [userId], references: [id])
  admin Admin? @relation(fields: [adminId], references: [id])
}





model Admin {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  phone     String   @unique
  refreshTokens RefreshToken[] 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
/**
 * ---------- PATIENT ----------
 * Unified model â€” includes all details & recall (meal) data
 */


model Doctor {
  id             String        @id @default(uuid())
  name           String
  phone          String?       @unique
  specialization String?
  bio            String?
  clinicAddress  String?
  slots          Slot[]
  appointments   Appointment[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}
model PatientDetials {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String
  name   String

  // Basic Info
  age    Int
  gender Gender

  // Body Measurements
  weight Float
  height Float
  neck   Float
  waist  Float
  hip    Float

  // Lifestyle
  wakeUpTime       String
  sleepTime        String
  sleepQuality     SleepQuality
  dailyWaterIntake Int

  // Medical Info
  medicalHistory String?

  // Food Habits
  foodPreference FoodPreference
  allergy        String?

  // Digestive Health
  bowelMovement BowelMovement

  // Recall Form / Meal Entries
  postWakeUpTime String?
  postWakeUpMeal String?
  breakfastTime  String?
  breakfastMeal  String?
  midMealTime    String?
  midMealMeal    String?
  lunchTime      String?
  lunchMeal      String?
  midEveningTime String?
  midEveningMeal String?
  dinnerTime     String?
  dinnerMeal     String?

  // Relations
  appointments Appointment[]
  files        File[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

/**
 * ---------- CORE BOOKING MODELS ----------
 */

model Slot {
  id          String       @id @default(uuid())
  doctor      Doctor       @relation(fields: [doctorId], references: [id])
  doctorId    String
  startAt     DateTime
  endAt       DateTime
  serviceType ServiceType
  isBooked    Boolean      @default(false)
  appointment Appointment?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@unique([doctorId, startAt])
}

model Appointment {
  id           String            @id @default(uuid())
  service      ServiceType
  startAt      DateTime
  endAt        DateTime
  status       AppointmentStatus @default(PENDING)
  user         User              @relation(fields: [userId], references: [id])
  userId       String
  doctor       Doctor            @relation(fields: [doctorId], references: [id])
  doctorId     String
  patient      PatientDetials           @relation(fields: [patientId], references: [id])
  patientId    String
  slot         Slot?             @relation(fields: [slotId], references: [id])
  slotId       String?           @unique
  paymentId    String?
  amount       Int?
  meetingUrl   String?
  notes        String?
  reminderSent Boolean           @default(false)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  @@index([startAt])
  @@index([doctorId, startAt])
}

/**
 * ---------- FILE UPLOADS ----------
 */

model File {
  id          String          @id @default(uuid())
  url         String
  fileName    String
  mimeType    String
  sizeInBytes Int
  provider    StorageProvider @default(CLOUDINARY)
  patient     PatientDetials         @relation(fields: [patientId], references: [id])
  patientId   String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}
